{"version":3,"file":"routes.js","sources":["routes.js","admin/line!tpl","admin/index.js"],"names":["define","AdminAccessController","css","actions","instancePermissions","classPermissions","hb","template","Handlebars","depth0","helpers","partials","data","this","compilerInfo","merge","stack1","helper","options","buffer","functionType","escapeExpression","helperMissing","label","call","hash","type","user","__","$","lineTpl","feedback","userSelect","roleSelect","tooltipConfig","content","theme","trigger","_preventManagerRemoval","$managers","find","$canAccess","closest","$deleteButtons","tooltipster","length","removeClass","addClass","_deletePermission","element","$this","append","text","value","remove","_addPermission","$table","body","selection","each","select2","index","val","push","id","_disableAccessOnGrant","$managersChecked","$cantWrite","$cantRead","not","$canWrite","$canRead","mainCtrl","start","$container","$form","$submiter","on","event","preventDefault","is","writeCheckbox","readCheckbox","click","e","stopImmediatePropagation","post","attr","serialize","done","res","success","error","complete"],"mappings":"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","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\n\ndefine('taoDacSimple/controller/routes',[],function(){\n    'user strict';\n    return {\n        'AdminAccessController' : {\n            'css': 'admin', \n            'actions' : {\n                'instancePermissions' : 'controller/admin/index',\n                'classPermissions' : 'controller/admin/index'\n            }\n        }\n    };\n});\n\n","\ndefine('tpl!taoDacSimple/controller/admin/line', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\n\n  buffer += \"<tr>\\n    <td>\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</td>\\n    <td>\\n        \";\n  if (helper = helpers.type) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.type); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\n        <input type=\\\"hidden\\\" name=\\\"users[\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"][type]\\\" value=\\\"\";\n  if (helper = helpers.type) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.type); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n    </td>\\n    <td>\\n        <label class=\\\"tooltip\\\">\\n            <input type=\\\"checkbox\\\" class=\\\"privilege-GRANT\\\" name=\\\"users[\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"][GRANT]\\\" value=\\\"1\\\">\\n            <span class=\\\"icon-checkbox\\\"></span>\\n        </label>\\n    </td>\\n    <td>\\n        <label class=\\\"tooltip\\\">\\n            <input type=\\\"checkbox\\\" class=\\\"privilege-WRITE\\\" name=\\\"users[\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"][WRITE]\\\" value=\\\"1\\\" checked>\\n            <span class=\\\"icon-checkbox\\\"></span>\\n        </label>\\n    </td>\\n    <td>\\n        <label class=\\\"tooltip\\\">\\n            <input type=\\\"checkbox\\\" class=\\\"privilege-READ\\\" name=\\\"users[\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"][READ]\\\" value=\\\"1\\\" checked>\\n            <span class=\\\"icon-checkbox\\\"></span>\\n        </label>\\n    </td>\\n    <td>\\n        <button type=\\\"button\\\" class=\\\"small delete_permission tooltip btn-link\\\" data-acl-user=\\\"\";\n  if (helper = helpers.user) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.user); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-acl-type=\\\"\";\n  if (helper = helpers.type) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.type); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-acl-label=\\\"\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" >\\n            <span class=\\\"icon-remove\\\"></span>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove\", options) : helperMissing.call(depth0, \"__\", \"Remove\", options)))\n    + \"\\n        </button>\\n    </td>\\n</tr>\\n\";\n  return buffer;\n  });\n});\n\n","define('taoDacSimple/controller/admin/index',[\n    'jquery',\n    'i18n',\n    'tpl!taoDacSimple/controller/admin/line',\n    'helpers',\n    'ui/feedback',\n    'select2',\n    'tooltipster'\n    ], function($, __, lineTpl, helpers, feedback){\n        'use strict';\n\n        var userSelect,\n            roleSelect,\n            tooltipConfig = {\n                content : __('You must have one role or user that have the manage permission on this element.'),\n                theme : 'tao-info-tooltip',\n                trigger: 'hover'\n            } ;\n\n        /**\n         * Provide a method the deactivate UI component that provide manager deletation\n         */\n        var _preventManagerRemoval = function(){\n            var $managers = $('#permissions-table').find('.privilege-GRANT:checked'),\n                $canAccess = $managers.closest('tr').find('.privilege-WRITE'),\n                $deleteButtons = $managers.closest('tr').find('.delete_permission');\n\n            $('.tooltip').tooltipster(tooltipConfig).tooltipster('disable');\n            $managers.closest('label').tooltipster('enable');\n            $canAccess.closest('label').tooltipster('enable');\n            $deleteButtons.tooltipster('enable');\n\n\n            if($managers.length > 1){\n                $deleteButtons.removeClass(\"disabled\").tooltipster('disable');\n                $managers.removeClass('disabled').closest('label').tooltipster('disable');\n            }else{\n                $deleteButtons.addClass(\"disabled\").tooltipster('enable');\n                $canAccess.addClass('disabled').closest('label').tooltipster('enable');\n                $managers.addClass(\"disabled\").closest('label').tooltipster('enable');\n            }\n        };\n\n        /**\n         * Delete a permission row for a user/role\n         * @param  {DOM Element} element DOM element that triggered the function\n         */\n        var _deletePermission = function(element) {\n            // 1. Get the user / role\n            var $this = $(element),\n                type = $this.data('acl-type'),\n                user = $this.data('acl-user'),\n                label = $this.data('acl-label');\n\n            if( typeof type !== \"undefined\" &&\n                typeof user !== \"undefined\" &&\n                typeof label !== \"undefined\" &&\n                type !== \"\" &&\n                user !== \"\" &&\n                label !== \"\"){\n                // 2. Add it to the select & remove the line\n                switch(type){\n                    case 'user':\n                        $('#add-user').append($('<option/>',{ text : label , value : user }));\n                        $this.closest('tr').remove();\n                        break;\n                    case 'role':\n                        $('#add-role').append($('<option/>',{ text : label , value : user }));\n                        $this.closest('tr').remove();\n                        break;\n                    default:\n                        break;\n                }\n            }\n            _preventManagerRemoval();\n        };\n        /**\n         * Add a new lines into the permissions table regarding what is selected into the add-* select\n         * @param {string} type role/user regarding what it will be added.\n         */\n        var _addPermission = function(type) {\n            var $table = $('#permissions-table'),\n                body = $table.find('tbody')[0],\n                selection = [];\n            //1. Get a list of all elements to add\n            switch(type){\n                case 'user':\n                    $.each(userSelect.select2(\"data\"), function(index, val) {\n                        // Push each selected element into an array\n                        selection.push({\n                            type : 'user',\n                            user : val.id,\n                            label : val.text\n                        });\n                        // Remove them from DOM\n                        userSelect.find('option[value=\"' + val.id + '\"]').remove();\n                    });\n                    // Reset Select2 tag display\n                    userSelect.select2(\"val\",\"\");\n                    break;\n                case 'role':\n                    $.each(roleSelect.select2(\"data\"), function(index, val) {\n                        // Push each selected element into an array\n                        selection.push({\n                            type : 'role',\n                            user : val.id,\n                            label : val.text\n                        });\n                        // Remove them from DOM\n                        roleSelect.find('option[value=\"' + val.id + '\"]').remove();\n                    });\n                    // Reset Select2 tag display\n                    roleSelect.select2(\"val\",\"\");\n                    break;\n                default:\n                    break;\n            }\n            // 2. Inject them into the table\n            $.each(selection, function(index,val) {\n                $(body).append(lineTpl(val));\n            });\n        };\n        /**\n         * Allow to enable / disable the access checkbox based on the state of the grant privilege\n         */\n        var _disableAccessOnGrant = function(){\n            var $managersChecked = $('#permissions-table').find('.privilege-GRANT:checked'),\n                $cantWrite = $managersChecked.closest('tr').find('.privilege-WRITE'),\n                $cantRead = $managersChecked.closest('tr').find('.privilege-READ'),\n                $managers = $('#permissions-table').find('.privilege-GRANT').not(':checked'),\n                $canWrite = $managers.closest('tr').find('.privilege-WRITE'),\n                $canRead = $managers.closest('tr').find('.privilege-READ');\n\n            $canWrite.removeClass('disabled').closest('label').tooltipster('disable');\n            $canRead.removeClass('disabled').closest('label').tooltipster('disable');\n            $cantWrite.addClass('disabled').closest('label').tooltipster('disable');\n            $cantRead.addClass('disabled').closest('label').tooltipster('disable');\n        };\n\n\n        var mainCtrl = {\n            'start' : function(){\n\n                var $container = $('.permission-container');\n                var $form      = $('form', $container);\n                var $submiter  = $(':submit', $form);\n\n                _preventManagerRemoval();\n                _disableAccessOnGrant();\n                userSelect = $('#add-user').select2();\n                roleSelect = $('#add-role').select2();\n\n\n                /**\n                 * Listen clicks on add user button\n                 */\n                $('#add-user-btn').on('click', function(event) {\n                    event.preventDefault();\n                    _addPermission('user');\n                });\n                /**\n                 * Listen clicks on add role button\n                 */\n                $('#add-role-btn').on('click', function(event) {\n                    event.preventDefault();\n                    _addPermission('role');\n                });\n\n                /**\n                 * Ensure that if you give the manage (GRANT) permission, access (WRITE and READ) permissions are given too\n                 * &\n                 * Listen all clicks on delete buttons to call the _deletePersmission function\n                 */\n                $('#permissions-table').on('click', '.privilege-GRANT:not(.disabled) ', function() {\n                    if ($(this).is(':checked') != []) {\n                        var writeCheckbox = $(this).closest('tr').find('.privilege-WRITE').not(':checked')[0];\n                        var readCheckbox = $(this).closest('tr').find('.privilege-READ').not(':checked')[0];\n                        $(writeCheckbox).click();\n                        $(readCheckbox).click();\n                    }\n                    _preventManagerRemoval();\n                    _disableAccessOnGrant();\n                }).on('click', '.delete_permission:not(.disabled)', function(event) {\n                    event.preventDefault();\n                    _deletePermission(this);\n                });\n                \n                $form.on('submit', function(e){\n                    e.preventDefault();\n                    e.stopImmediatePropagation();\n                });\n                $submiter.on('click', function(e){\n                    e.preventDefault();\n\n                    $submiter.addClass('disabled');\n\n                    $.post($form.attr('action'), $form.serialize())\n                        .done(function(res){\n                            if(res && res.success){\n                                feedback().success(__(\"Permissions saved\"));\n                            } else {\n                                feedback().error(__(\"Something went wrong...\"));\n                            }\n                        })\n                        .complete(function(){\n                            $submiter.removeClass('disabled');\n                        });\n                });\n            }\n        };\n\n        return mainCtrl;\n    })\n;\n"]}