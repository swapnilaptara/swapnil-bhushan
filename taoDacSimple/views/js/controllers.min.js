define("taoDacSimple/controller/routes",[],function(){"user strict";return{AdminAccessController:{css:"admin",actions:{instancePermissions:"controller/admin/index",classPermissions:"controller/admin/index"}}}}),define("tpl!taoDacSimple/controller/admin/line",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+="<tr>\n    <td>",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</td>\n    <td>\n        ",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'\n        <input type="hidden" name="users[',(helper=helpers.user)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.user,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'][type]" value="',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    </td>\n    <td>\n        <label class="tooltip">\n            <input type="checkbox" class="privilege-GRANT" name="users[',(helper=helpers.user)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.user,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'][GRANT]" value="1">\n            <span class="icon-checkbox"></span>\n        </label>\n    </td>\n    <td>\n        <label class="tooltip">\n            <input type="checkbox" class="privilege-WRITE" name="users[',(helper=helpers.user)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.user,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'][WRITE]" value="1" checked>\n            <span class="icon-checkbox"></span>\n        </label>\n    </td>\n    <td>\n        <label class="tooltip">\n            <input type="checkbox" class="privilege-READ" name="users[',(helper=helpers.user)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.user,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'][READ]" value="1" checked>\n            <span class="icon-checkbox"></span>\n        </label>\n    </td>\n    <td>\n        <button type="button" class="small delete_permission tooltip btn-link" data-acl-user="',(helper=helpers.user)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.user,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-acl-type="',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-acl-label="',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" >\n            <span class="icon-remove"></span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove",options):helperMissing.call(depth0,"__","Remove",options)))+"\n        </button>\n    </td>\n</tr>\n"
})}),define("taoDacSimple/controller/admin/index",["jquery","i18n","tpl!taoDacSimple/controller/admin/line","helpers","ui/feedback","select2","tooltipster"],function($,__,lineTpl,helpers,feedback){"use strict";var userSelect,roleSelect,tooltipConfig={content:__("You must have one role or user that have the manage permission on this element."),theme:"tao-info-tooltip",trigger:"hover"},_preventManagerRemoval=function(){var $managers=$("#permissions-table").find(".privilege-GRANT:checked"),$canAccess=$managers.closest("tr").find(".privilege-WRITE"),$deleteButtons=$managers.closest("tr").find(".delete_permission");$(".tooltip").tooltipster(tooltipConfig).tooltipster("disable"),$managers.closest("label").tooltipster("enable"),$canAccess.closest("label").tooltipster("enable"),$deleteButtons.tooltipster("enable"),$managers.length>1?($deleteButtons.removeClass("disabled").tooltipster("disable"),$managers.removeClass("disabled").closest("label").tooltipster("disable")):($deleteButtons.addClass("disabled").tooltipster("enable"),$canAccess.addClass("disabled").closest("label").tooltipster("enable"),$managers.addClass("disabled").closest("label").tooltipster("enable"))
},_deletePermission=function(element){var $this=$(element),type=$this.data("acl-type"),user=$this.data("acl-user"),label=$this.data("acl-label");if("undefined"!=typeof type&&"undefined"!=typeof user&&"undefined"!=typeof label&&""!==type&&""!==user&&""!==label)switch(type){case"user":$("#add-user").append($("<option/>",{text:label,value:user})),$this.closest("tr").remove();break;case"role":$("#add-role").append($("<option/>",{text:label,value:user})),$this.closest("tr").remove()}_preventManagerRemoval()},_addPermission=function(type){var $table=$("#permissions-table"),body=$table.find("tbody")[0],selection=[];switch(type){case"user":$.each(userSelect.select2("data"),function(index,val){selection.push({type:"user",user:val.id,label:val.text}),userSelect.find('option[value="'+val.id+'"]').remove()
}),userSelect.select2("val","");break;case"role":$.each(roleSelect.select2("data"),function(index,val){selection.push({type:"role",user:val.id,label:val.text}),roleSelect.find('option[value="'+val.id+'"]').remove()}),roleSelect.select2("val","")}$.each(selection,function(index,val){$(body).append(lineTpl(val))})},_disableAccessOnGrant=function(){var $managersChecked=$("#permissions-table").find(".privilege-GRANT:checked"),$cantWrite=$managersChecked.closest("tr").find(".privilege-WRITE"),$cantRead=$managersChecked.closest("tr").find(".privilege-READ"),$managers=$("#permissions-table").find(".privilege-GRANT").not(":checked"),$canWrite=$managers.closest("tr").find(".privilege-WRITE"),$canRead=$managers.closest("tr").find(".privilege-READ");
$canWrite.removeClass("disabled").closest("label").tooltipster("disable"),$canRead.removeClass("disabled").closest("label").tooltipster("disable"),$cantWrite.addClass("disabled").closest("label").tooltipster("disable"),$cantRead.addClass("disabled").closest("label").tooltipster("disable")},mainCtrl={start:function(){var $container=$(".permission-container"),$form=$("form",$container),$submiter=$(":submit",$form);_preventManagerRemoval(),_disableAccessOnGrant(),userSelect=$("#add-user").select2(),roleSelect=$("#add-role").select2(),$("#add-user-btn").on("click",function(event){event.preventDefault(),_addPermission("user")}),$("#add-role-btn").on("click",function(event){event.preventDefault(),_addPermission("role")
}),$("#permissions-table").on("click",".privilege-GRANT:not(.disabled) ",function(){if($(this).is(":checked")!=[]){var writeCheckbox=$(this).closest("tr").find(".privilege-WRITE").not(":checked")[0],readCheckbox=$(this).closest("tr").find(".privilege-READ").not(":checked")[0];$(writeCheckbox).click(),$(readCheckbox).click()}_preventManagerRemoval(),_disableAccessOnGrant()}).on("click",".delete_permission:not(.disabled)",function(event){event.preventDefault(),_deletePermission(this)}),$form.on("submit",function(e){e.preventDefault(),e.stopImmediatePropagation()}),$submiter.on("click",function(e){e.preventDefault(),$submiter.addClass("disabled"),$.post($form.attr("action"),$form.serialize()).done(function(res){res&&res.success?feedback().success(__("Permissions saved")):feedback().error(__("Something went wrong..."))
}).complete(function(){$submiter.removeClass("disabled")})})}};return mainCtrl});
//# sourceMappingURL=routes.js
//# sourceMappingURL=routes.js.map