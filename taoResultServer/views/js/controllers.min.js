define("taoResultServer/controller/routes",[],function(){"use strict";return{ResultServerMgt:{actions:{migrate:"controller/migrate"}}}}),define("taoResultServer/controller/migrate",["module","jquery","i18n","context","helpers","ui/feedback"],function(module,$,__,context,helpers,feedback){var migrateRunner={start:function(){$(".opButton").click(function(){var source,operation=$(this).attr("id"),sources=[],targets=[],$source=$("#selSource"),$target=$("#selTarget"),$migrationDialog=$("#migrationProgress"),$migrationInfo=$migrationDialog.children(".migrationInfo"),migrateDataUrl=context.root_url+"taoResultServer/ResultServerMgt/migrateData";return $source.empty(),$target.empty(),$("#sourceStorage :checked").each(function(){source=$(this).val(),sources.push(source),$source.append($("<li />",{id:source.replace(/[^a-z0-9-_]+/gi,"_")}).html($(this).parent().text()))
}),sources.length?($("#targetStorage :checked").each(function(){targets.push($(this).val()),$target.append($("<li />").text($(this).parent().text()))}),targets.length?($("#selOperation").html("<label>"+operation+"</label>"),$migrationInfo.children().show(),void $migrationDialog.attr("style","visibility: visible").dialog({modal:!0,width:500,height:430,buttons:[{id:"MigrationClose",text:__("Cancel"),click:function(){$(this).dialog("close")}},{id:"MigrationStart",text:__("Migrate"),click:function(){$migrationInfo.hide(),$migrationDialog.children(".migrationResult").hide(),$migrationDialog.children(".migrationProgress").show(),$("#MigrationStart").addClass("disabled").off("click"),$.ajax({url:migrateDataUrl,type:"POST",dataType:"JSON",data:{source:sources,target:targets,operation:operation},success:function(data){if($migrationDialog.children(".migrationProgress").hide(),!data.success)return info.show(),void feedback().error(data.status);
$migrationInfo.children(":not(#selSource)").hide();var id,$ul=$("<ul/>",{"class":"StorageResult"});$.each(data.data,function(i,source){id=source.uri.replace(/[^a-z0-9-_]+/gi,"_"),$ul.append($("<li />",{text:source.testTakers+__(" test takers")})),$ul.append($("<li />",{text:source.deliveries+__(" deliveries")})),$ul.append($("<li />",{text:source.callIds+__(" call ids")})),$("#"+id).addClass("success").append($ul)}),$("#selSource").prepend($("<h3/>",{text:data.status})),$migrationInfo.show(),$("#MigrationClose").text(__("Close")),feedback().success(data.status)},error:function(){$migrationDialog.children(".migrationProgress").hide(),$migrationInfo.show()}})}}]})):void feedback().error(__("Please select a destination target"))):void feedback().error(__("Please select a migration source"))
})}};return migrateRunner});
//# sourceMappingURL=routes.js
//# sourceMappingURL=routes.js.map